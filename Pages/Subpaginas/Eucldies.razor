@page "/ferramentas/euclides"

@inject IPrincipal _principal

<MudText Typo="Typo.h4">@(conta == "inverso" ? "Inverso modular" : "Combinação linear") utilizando euclides estendido</MudText>

<MudItem Style="display: flex">
    <div style="width: 300px; margin-right: 10px">
        <MudTextField Style="margin-right: 10px" T="string" @bind-Value="@Txt" Label="Números" Variant="Variant.Outlined"></MudTextField>
    </div>
    <div style="width: 170px; margin-right: 10px">
        <MudSelect T="string" Label="Modo" @bind-Value="@conta">
            <MudSelectItem T="string" Value="@("linear")">Combinação linear</MudSelectItem>
            <MudSelectItem T="string" Value="@("inverso")">Inverso modular</MudSelectItem>
        </MudSelect>
    </div>
    <MudButton Color="Color.Dark" Variant="Variant.Filled" Size="Size.Large" OnClick="@Gerar">Calcular</MudButton>
</MudItem>

@if (conta == "linear")
{
    @if (result.x != -24102003)
    {
        <MudText Typo="Typo.h6">@result.mdc = @result.x*@result.a @(result.y >= 0 ? "+" :"") @result.y*@result.b</MudText>
    }
}
else
{
    @if (result.inverso.existe)
    {
        <MudText Typo="Typo.h6">O inverso de @result.a (mod @result.b) é @result.inverso.valor</MudText>
    }
    else
    {
        @if (result.mdc != 1 && result.x != -24102003)
        {
            <MudText Typo="Typo.h6">@result.a e @result.b não são primos entre si! MDC: @result.mdc</MudText>
        }
    }
}

@code{

    //string Titulo = "Combinação linear";
    string Txt = "";
    string conta = "linear";

    Result result = new Result();

    class Result
    {
        public long x = -24102003;
        public long y = -1;
        public long mdc = -1;
        public long a = -1;
        public long b = -1;
        public dynamic inverso = new {valor=-1,existe=false};

        public Result(long X, long Y, long MDC, long A, long B, dynamic Inverso=null)
        {
            x = X;
            y = Y;
            mdc = MDC;
            a = A;
            b = B;
            inverso = Inverso ?? new {valor=-1,existe=false};
        }
        
        public Result(){}
    }

    void Gerar()
    {
        if (conta == "linear")
        {
            Console.WriteLine($"Irei calcular: {Txt}");
            string[] spl = Txt.Split(",");
            result.a = long.Parse(spl[0]);
            result.b = long.Parse(spl[1]);
            dynamic r = _principal.EuclidesEstendido(result.a, result.b, operacao:"linear");
            result = new Result(r.x, r.y, r.mdc, r.a, r.b);
            InvokeAsync(StateHasChanged);
        }
        else
        {
            string[] spl = Txt.Split(",");
            result.a = long.Parse(spl[0]);
            result.b = long.Parse(spl[1]);
            dynamic r = _principal.EuclidesEstendido(result.a, result.b, operacao:"inverso");
            result = new Result(r.x, r.y, r.mdc, r.a, r.b, Inverso:r.inverso);
            Console.WriteLine($"y: {result.y} b:{result.b}");
            InvokeAsync(StateHasChanged);
        }
    }

    void TxtEnter(KeyboardEventArgs e)
    {
        if(e.Key.ToLower() == "enter") Gerar();
    }
    
}